---
title: "Hypothesis test"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(patchwork)
library(plotly)
library(leaflet)
library(ggplot2)
library(lubridate)

knitr::opts_chunk$set(
  fig.height = 6,
  fig.width = 8,
  message = T,
  echo = T,
  warning = T,
  cache = F
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis",
  digits = 3
)

scale_colour_discrete = scale_colour_viridis_d

scale_fill_discrete = scale_fill_viridis_d


cafe = read_csv(here::here("data/Sidewalk_Caf__Licenses_and_Applications_clean.csv"))

parking = read_csv(here::here("data/parking_vio2021_cleanv1.csv")) %>%
  filter(hour != 12.3, hour <= 24) %>%
  left_join(
    read_csv("./data/Parking_Violations_Issued_-_Fiscal_Year_2021.csv") %>%
      janitor::clean_names() %>%
      select(summons_number, violation_county)
  ) %>%
  mutate(
    borough =
      case_when(
        violation_county %in% c("BK", "K") ~ "Brooklyn",
        violation_county %in% c("MN", "NY") ~ "Manhattan",
        violation_county %in% c("Q", "QN") ~ "Queens",
        violation_county %in% c("BX") ~ "Bronx"
      ),
    borough = replace_na(borough, "Staten Island")
  )%>% 
  drop_na(address)

```




# fine amount and different boros

From data exploration, we have notice that the violation code varies among 
boroughs as well as the fine amount. We see from the table that the mean of 
fine amount in Queen is different from the Manhattan by 10$, and thus, we 
propose hypothesis that there's at least 1 pairs of boroughs' fine amount is 
different from others.


```{r,echo = FALSE, message=FALSE,warning = FALSE}
parking %>% 
  drop_na(fine_amount, borough)%>%
  select(borough, fine_amount)%>%
  group_by(borough) %>% 
  summarize(mean = mean(fine_amount),
            standard_error = sd(fine_amount)) %>% 
  knitr::kable(caption = "Fine Amount in borough")

```

To do that, we perform ANOVA test for multiple groups comparison. With:

$H_0$ : there's no difference of fine amount means between boroughs

$H_1$ : at least two fine amount means of boroughs are not equal

```{r,echo = FALSE, message=FALSE,warning = FALSE}
boro_amount = parking %>% 
  drop_na(fine_amount, borough)%>%
  select(borough, fine_amount)%>%
  group_by(borough) 

aov_boro_amount = aov(fine_amount ~factor(borough), data = boro_amount)
summary(aov_boro_amount)
Tukey_comp<-TukeyHSD(aov_boro_amount,conf.level = 0.99)
Tukey_comp$`factor(borough)` %>% knitr::kable(caption = "Turkey Test at 99% confidence Level")
```


As the ANOVA test result from above, we reject the Null at 99% confidence level 
and conclude that there's at least one borough's mean of fine amount is different from others.

To further investigate the difference between boroughs, we perform Tukey test for pairwise comparison. Notice that all paris are different from each other in
 the setting of our data. Given the large amount of data, according to the law 
 of large number, the estimate of mean fine amount close to the true mean of the
  fine amount in different borough. Under this setting, we have 99% confidence 
  that Manhattan have different mean of fine amount than other borough. So if 
  you unfortunately get a RISKY coffee, it is much burning than in other boroughs.


# Hypothesis Test for Violation Counts


## Chi-Squared test between violation counts generated in each weekdays and different boroughs

From data exploration, we have noticed that the violation counts proportions in different weekdays among each boroughs are different.Thus, we assume there is no homogeneity in tickets counts proportions in each weekdays among boroughs. 


To verify that, we performed Chi-squared test for multiple groups comparison. With:

$H_0$ : the tickets proportion in weekdays among boroughs are equal.

$H_1$ : not all proportions are equal

```{r,echo = FALSE, message=FALSE,warning = FALSE}


day_order = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")

chisq_boro_day = 
  parking %>% 
  mutate(day_week = weekdays(issue_date),
         day_week = factor(day_week, levels = day_order)) %>% 
  arrange(day_week) %>% 
  count(borough, day_week) %>% 
  drop_na(day_week, borough) %>% 
  pivot_wider(names_from = day_week,
              values_from = n) %>% 
  subset(select = c(-borough)) %>% 
  data.matrix() 
 
rownames(chisq_boro_day) <- c("Bronx", "Brooklyn", "Manhattan", "Queens", "Staten Island")
 
chisq_boro_day%>% 
  knitr::kable(caption = "Test Result")

chisq.test(chisq_boro_day)

x_crit = qchisq(0.95,24)
x_crit   # x critical value
```

According to above chi-square test result,  We reject the null hypothesis and conclude that there's at least one borough's proportions of violation counts for week days is different from others at 0.05 significant level.  


## Test whether the the probability of falling in the each hour is the same for each borough:

```{r,echo = FALSE, message=FALSE,warning = FALSE}


chisq_boro_hour = 
  parking %>% 
  filter(hour != 12.3) %>% 
  filter(hour < 24) %>% 
  count(borough, hour) %>% 
  drop_na(borough) %>% 
  pivot_wider(names_from = hour,
              values_from = n) %>% 
  subset(select = c(-borough)) %>% 
  data.matrix() 
 
rownames(chisq_boro_hour) <- c("Bronx", "Brooklyn", "Manhattan", "Queens", "Staten Island")
 
chisq_boro_hour %>% 
  knitr::kable(caption = "Distribution of ticket in a day")

chisq.test(chisq_boro_hour)

x_crit = qchisq(0.95,92)
x_crit   # x critical value
```

According to above chi-square test result,  We reject the null hypothesis and conclude that there's at least one borough's proportions of violation counts for 24 hours is different from others at 0.05 significant level.  

Sine 526.14 million square feet of office space existed in Manhattan in 2020. Manhattanâ€™s office space is located in 3,830 commercial buildings in the major markets of Midtown, Midtown South, Lower Manhattan and Uptown [[Statistics](https://www.statista.com/statistics/605882/size-of-office-area-manhattan-by-submarket/)]. At any given time most of this office space is rented. Manhattan becomes the well deserved business center in NYC. Due to the unequal active status of commerce among boroughs and expensive costs of keeping a car in NYC, the active area of life and work for people who own a car concentrates upon Manhattan. This is one of reasonable explanations of chi-square test result. But this situation might be changed since the commercial areas tend to extend to other boroughs. Some data in the report shows that the Bronx office market and the Staten Island office market have seen increased investor interest over the past 10 years [[click here to get more detailed information](https://www.metro-manhattan.com/blog/market-report-a-look-at-nyc-office-sales-activity-from-2010-to-2020/)].




